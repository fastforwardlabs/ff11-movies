{"version":3,"file":"static/webpack/static/development/pages/index.js.6b030191604fc330c1b1.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import React from 'react'\nimport Link from '../parts/PrefixedLink'\nimport * as _ from 'lodash'\nimport * as d3 from 'd3'\nimport * as chroma from 'chroma-js'\nimport Bar from '../parts/Bar'\nimport { red, blue, scaleRed, scaleBlue } from '../parts/Static'\n\nlet class_labels = ['negative', 'positive']\n\nclass Index extends React.Component {\n  componentDidMount() {\n    // let boxed = data.reduce((dict, current) => {\n    //   let slice = Object.assign({}, dict)\n    //   if (slice[current.url] === undefined) {\n    //     slice[current.url] = 'exists'\n    //   }\n    //   return slice\n    // }, {})\n    // let movie_keys = Object.keys(boxed)\n    // var promises = movie_keys.map((k, i) => {\n    //   return fetch(`http://www.omdbapi.com/?apikey=af4abd65&i=${k}`)\n    //     .then(r => r.json())\n    //     .then(json => {\n    //       let og_id = k\n    //       if (json.Title === '#DUPE#') {\n    //         return fetch(\n    //           `http://www.omdbapi.com/?apikey=af4abd65&i=${json.imdbID}`\n    //         )\n    //           .then(r => r.json())\n    //           .then(json => {\n    //             let json_mod = Object.assign({}, json)\n    //             json_mod.og_id = og_id\n    //             return json_mod\n    //           })\n    //       } else {\n    //         let json_mod = Object.assign({}, json)\n    //         json_mod.og_id = og_id\n    //         return json_mod\n    //       }\n    //     })\n    // })\n    // Promise.all(promises).then(function(results) {\n    //   console.log(JSON.stringify(results))\n    // })\n  }\n\n  render() {\n    let {\n      font_size,\n      line_height,\n      grem,\n      analyze,\n      data,\n      info,\n      reviews,\n      setAnalyze,\n      sort,\n    } = this.props\n    let sorted = info.map(o => {\n      return {\n        title: o.Title,\n        id: o.og_id,\n        plot: o.Plot,\n        poster: o.Poster,\n        children: [],\n      }\n    })\n    let ids = sorted.map(o => o.id)\n    if (data !== null) {\n      for (let i = 0; i < data.length; i++) {\n        let o = data[i]\n        let id = o.url\n        let index = ids.indexOf(id)\n        if (index === -1) {\n          console.log('miss')\n        } else {\n          sorted[index].children.push(o)\n        }\n      }\n      if (sort === 'reviews') {\n        sorted = _.sortBy(sorted, [\n          function(o) {\n            return o.children.length\n          },\n        ])\n        sorted.reverse()\n      } else {\n        sorted = _.sortBy(sorted, [\n          function(o) {\n            return (\n              o.children.reduce(\n                (total, r) => (r.class === 'neg' ? total + 1 : total),\n                0\n              ) / o.children.length\n            )\n          },\n        ])\n      }\n    }\n\n    let pos_count = data.reduce((total, o) => {\n      if (o.class === 'pos') {\n        return (total = total + 1)\n      } else {\n        return total\n      }\n    }, 0)\n\n    let neg_count = data.reduce((total, o) => {\n      if (o.class === 'neg') {\n        return (total = total + 1)\n      } else {\n        return total\n      }\n    }, 0)\n\n    // overloading this variables, will probably come back to bite me\n    let winner_name = 'positive'\n    if (neg_count > pos_count) winner_name = 'negative'\n    let total_counts = [neg_count, pos_count]\n\n    let certainty_array = data.map(r => {\n      if (r.logits[1] > r.logits[0]) {\n        return {\n          class: r.class,\n          certainty: r.class_probabilities[1],\n        }\n      } else {\n        return {\n          class: r.class,\n          certainty: r.class_probabilities[0],\n        }\n      }\n    })\n    let pos = _.sortBy(\n      certainty_array.filter(r => r.class === 'pos'),\n      'certainty'\n    ).reverse()\n    let neg = _.sortBy(\n      certainty_array.filter(r => r.class === 'neg'),\n      'certainty'\n    )\n    let combined = [...pos, ...neg]\n\n    return (\n      <div>\n        <div>\n          <div style={{ paddingBottom: grem * 3 }}>\n            <div\n              style={{\n                borderBottom: 'none',\n                margin: `0 auto`,\n                display: 'grid',\n                gridTemplateColumns: `repeat(auto-fit, minmax(240px, 1fr))`,\n                gridColumnGap: grem,\n                gridRowGap: grem,\n                padding: `0 ${grem / 2}px`,\n              }}\n            >\n              {data ? (\n                <>\n                  {sorted.map((o, i) => {\n                    let reviews = data.filter(r => r.url === o.id)\n\n                    let counts = reviews.reduce(\n                      (counts, r) => {\n                        let slice = counts.slice()\n                        if (r.logits[1] > r.logits[0]) {\n                          slice[1] += 1\n                        } else {\n                          slice[0] += 1\n                        }\n                        return slice\n                      },\n                      [0, 0]\n                    )\n\n                    let actual = reviews.reduce(\n                      (counts, r) => {\n                        let slice = counts.slice()\n                        if (r.label === 'pos') {\n                          slice[1] += 1\n                        } else if (r.label === 'neg') {\n                          slice[0] += 1\n                        }\n                        return slice\n                      },\n                      [0, 0]\n                    )\n\n                    let rightwrong = reviews.reduce(\n                      (counts, r) => {\n                        let slice = counts.slice()\n                        if (r.label === r.class) {\n                          slice[1] += 1\n                        } else {\n                          slice[0] += 1\n                        }\n                        return slice\n                      },\n                      [0, 0]\n                    )\n                    let accuracy = rightwrong[1] / reviews.length\n\n                    let winner_count_index = 0\n                    if (counts[1] > counts[0]) winner_count_index = 1\n                    let winner_names = ['negative', 'positive']\n                    let winner_name = winner_names[winner_count_index]\n\n                    let certainty_array = reviews.map(r => {\n                      if (r.logits[1] > r.logits[0]) {\n                        return {\n                          class: r.class,\n                          certainty: r.class_probabilities[1],\n                        }\n                      } else {\n                        return {\n                          class: r.class,\n                          certainty: r.class_probabilities[0],\n                        }\n                      }\n                    })\n                    let pos = _.sortBy(\n                      certainty_array.filter(r => r.class === 'pos'),\n                      'certainty'\n                    ).reverse()\n                    let neg = _.sortBy(\n                      certainty_array.filter(r => r.class === 'neg'),\n                      'certainty'\n                    )\n                    let combined = [...pos, ...neg]\n\n                    return (\n                      <Link href={`/topic2?id=${o.id}`}>\n                        <a\n                          className=\"no-underline over-hover-container\"\n                          style={{\n                            border: 'solid 1px black',\n                            position: 'relative',\n                            overflow: 'hidden',\n                            height: 13 * grem,\n                          }}\n                        >\n                          hi\n                        </a>\n                      </Link>\n                    )\n                  })}\n                </>\n              ) : null}\n            </div>\n          </div>\n        </div>\n        <Bar\n          grem={grem}\n          setAnalyze={setAnalyze}\n          analyze={analyze}\n          combined={combined}\n        />\n      </div>\n    )\n  }\n}\n\nexport default Index\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAAA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAAA;AAAA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAJA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AAOA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;;;;AA5PA;AACA;AA8PA;;;;A","sourceRoot":""}