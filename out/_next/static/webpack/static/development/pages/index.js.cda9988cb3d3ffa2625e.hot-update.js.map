{"version":3,"file":"static/webpack/static/development/pages/index.js.cda9988cb3d3ffa2625e.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import React from 'react'\nimport Link from '../parts/PrefixedLink'\nimport * as _ from 'lodash'\nimport * as d3 from 'd3'\nimport * as chroma from 'chroma-js'\nimport Bar from '../parts/Bar'\nimport {\n  red,\n  blue,\n  scaleRed,\n  scaleBlue,\n  readableSentiment,\n} from '../parts/Static'\n\nlet class_labels = ['negative', 'positive']\n\nclass Index extends React.Component {\n  componentDidMount() {\n    // let boxed = data.reduce((dict, current) => {\n    //   let slice = Object.assign({}, dict)\n    //   if (slice[current.url] === undefined) {\n    //     slice[current.url] = 'exists'\n    //   }\n    //   return slice\n    // }, {})\n    // let movie_keys = Object.keys(boxed)\n    // var promises = movie_keys.map((k, i) => {\n    //   return fetch(`http://www.omdbapi.com/?apikey=af4abd65&i=${k}`)\n    //     .then(r => r.json())\n    //     .then(json => {\n    //       let og_id = k\n    //       if (json.Title === '#DUPE#') {\n    //         return fetch(\n    //           `http://www.omdbapi.com/?apikey=af4abd65&i=${json.imdbID}`\n    //         )\n    //           .then(r => r.json())\n    //           .then(json => {\n    //             let json_mod = Object.assign({}, json)\n    //             json_mod.og_id = og_id\n    //             return json_mod\n    //           })\n    //       } else {\n    //         let json_mod = Object.assign({}, json)\n    //         json_mod.og_id = og_id\n    //         return json_mod\n    //       }\n    //     })\n    // })\n    // Promise.all(promises).then(function(results) {\n    //   console.log(JSON.stringify(results))\n    // })\n  }\n\n  render() {\n    let {\n      font_size,\n      line_height,\n      grem,\n      analyze,\n      data,\n      info,\n      reviews,\n      setAnalyze,\n      sort,\n      setSort,\n    } = this.props\n    let sorted = info.map(o => {\n      let new_o = Object.assign({}, o)\n      new_o.children = []\n      new_o.id = o.og_id\n      return new_o\n    })\n    let ids = sorted.map(o => o.id)\n    if (data !== null) {\n      for (let i = 0; i < data.length; i++) {\n        let o = data[i]\n        let id = o.url\n        let index = ids.indexOf(id)\n        if (index === -1) {\n          console.log('miss')\n        } else {\n          sorted[index].children.push(o)\n        }\n      }\n      if (sort === 'reviews') {\n        sorted = _.sortBy(sorted, [\n          function(o) {\n            return o.children.length\n          },\n        ])\n        sorted.reverse()\n      } else if (sort === 'positive') {\n        sorted = _.sortBy(sorted, [\n          function(o) {\n            return (\n              o.children.reduce(\n                (total, r) => (r.class === 'neg' ? total + 1 : total),\n                0\n              ) / o.children.length\n            )\n          },\n        ])\n      } else if (sort === 'negative') {\n        sorted = _.sortBy(sorted, [\n          function(o) {\n            return (\n              o.children.reduce(\n                (total, r) => (r.class === 'neg' ? total + 1 : total),\n                0\n              ) / o.children.length\n            )\n          },\n        ]).reverse()\n      }\n    }\n\n    let pos_count = data.reduce((total, o) => {\n      if (o.class === 'pos') {\n        return (total = total + 1)\n      } else {\n        return total\n      }\n    }, 0)\n\n    let neg_count = data.reduce((total, o) => {\n      if (o.class === 'neg') {\n        return (total = total + 1)\n      } else {\n        return total\n      }\n    }, 0)\n\n    // overloading this variables, will probably come back to bite me\n    let winner_name = 'positive'\n    if (neg_count > pos_count) winner_name = 'negative'\n    let total_counts = [neg_count, pos_count]\n\n    let certainty_array = data.map(r => {\n      if (r.logits[1] > r.logits[0]) {\n        return {\n          class: r.class,\n          certainty: r.class_probabilities[1],\n        }\n      } else {\n        return {\n          class: r.class,\n          certainty: r.class_probabilities[0],\n        }\n      }\n    })\n    let pos = _.sortBy(\n      certainty_array.filter(r => r.class === 'pos'),\n      'certainty'\n    ).reverse()\n    let neg = _.sortBy(\n      certainty_array.filter(r => r.class === 'neg'),\n      'certainty'\n    )\n    let combined = [...pos, ...neg]\n\n    return (\n      <div>\n        <div\n          style={{\n            paddingBottom: grem / 2,\n            display: 'flex',\n          }}\n        >\n          <div\n            style={{\n              paddingTop: grem / 2,\n              paddingBottom: grem / 2,\n              paddingLeft: grem / 2,\n              paddingRight: grem / 4,\n            }}\n          >\n            {sorted.length} movies/TV shows sorted by:\n          </div>\n          <div\n            style={{\n              display: 'flex',\n              paddingRight: grem / 4,\n              paddingTop: grem / 2,\n              paddingBottom: grem / 2,\n            }}\n          >\n            {(analyze\n              ? [\n                  ['review number', 'reviews'],\n                  ['positive', 'positive'],\n                  ['negative', 'negative'],\n                ]\n              : [['review number', 'reviews']]\n            ).map(a =>\n              sort === a[1] ? (\n                <div\n                  style={{\n                    paddingLeft: grem / 4,\n                    paddingRight: grem / 4,\n                    outline: 'solid 1px black',\n                  }}\n                >\n                  {a[0]}\n                </div>\n              ) : (\n                <button\n                  onClick={() => {\n                    setSort(a[1])\n                  }}\n                  style={{\n                    paddingLeft: grem / 4,\n                    paddingRight: grem / 4,\n                    textDecoration: 'underline',\n                  }}\n                >\n                  {a[0]}\n                </button>\n              )\n            )}\n          </div>\n        </div>\n        <div>\n          <div style={{ paddingBottom: grem / 2 }}>\n            <div\n              style={{\n                borderBottom: 'none',\n                margin: `-1px -1px -1px -1px`,\n                display: 'grid',\n                gridTemplateColumns: `repeat(auto-fit, minmax(240px, 1fr))`,\n                gridColumnGap: grem,\n                gridRowGap: grem,\n                padding: `0 ${grem / 2}px`,\n              }}\n            >\n              {data ? (\n                <>\n                  {sorted.map((o, i) => {\n                    let topic_info = o\n                    let reviews = data.filter(r => r.url === o.id)\n\n                    let counts = reviews.reduce(\n                      (counts, r) => {\n                        let slice = counts.slice()\n                        if (r.logits[1] > r.logits[0]) {\n                          slice[1] += 1\n                        } else {\n                          slice[0] += 1\n                        }\n                        return slice\n                      },\n                      [0, 0]\n                    )\n\n                    let actual = reviews.reduce(\n                      (counts, r) => {\n                        let slice = counts.slice()\n                        if (r.label === 'pos') {\n                          slice[1] += 1\n                        } else if (r.label === 'neg') {\n                          slice[0] += 1\n                        }\n                        return slice\n                      },\n                      [0, 0]\n                    )\n\n                    let rightwrong = reviews.reduce(\n                      (counts, r) => {\n                        let slice = counts.slice()\n                        if (r.label === r.class) {\n                          slice[1] += 1\n                        } else {\n                          slice[0] += 1\n                        }\n                        return slice\n                      },\n                      [0, 0]\n                    )\n                    let accuracy = rightwrong[1] / reviews.length\n\n                    let winner_count_index = 0\n                    if (counts[1] > counts[0]) winner_count_index = 1\n                    let winner_names = ['negative', 'positive']\n                    let winner_name = winner_names[winner_count_index]\n\n                    let certainty_array = reviews.map(r => {\n                      if (r.logits[1] > r.logits[0]) {\n                        return {\n                          class: r.class,\n                          certainty: r.class_probabilities[1],\n                        }\n                      } else {\n                        return {\n                          class: r.class,\n                          certainty: r.class_probabilities[0],\n                        }\n                      }\n                    })\n                    let pos = _.sortBy(\n                      certainty_array.filter(r => r.class === 'pos'),\n                      'certainty'\n                    ).reverse()\n                    let neg = _.sortBy(\n                      certainty_array.filter(r => r.class === 'neg'),\n                      'certainty'\n                    )\n                    let combined = [...pos, ...neg]\n\n                    return (\n                      <Link href={`/topic2?id=${o.id}`}>\n                        <a\n                          className=\"no-underline hover-block-container no-opacity-hover\"\n                          style={{\n                            position: 'relative',\n                            height: 12 * grem,\n                            cursor: 'zoom-in',\n                          }}\n                        >\n                          <div\n                            style={{\n                              position: 'absolute',\n                              left: -grem / 2 - 0.5,\n                              top: -grem / 2 - 0.5,\n                              right: -grem / 2 - 0.5,\n                              bottom: -grem / 2 - 0.5,\n                              border: 'solid 1px black',\n                            }}\n                          />\n                          {analyze ? (\n                            <div\n                              style={{\n                                position: 'absolute',\n                                left: 0,\n                                bottom: 0,\n                                right: 0,\n                                height: grem,\n                              }}\n                            >\n                              {combined.map((c, i) => (\n                                <div\n                                  style={{\n                                    position: 'absolute',\n                                    left: `${(1 / combined.length) * i * 100}%`,\n                                    bottom: 0,\n                                    height: grem,\n                                    width: `${(1 / combined.length) * 100 +\n                                      0.05}%`,\n                                    background:\n                                      c.class === 'pos'\n                                        ? scaleBlue(c.certainty)\n                                        : scaleRed(c.certainty),\n                                  }}\n                                />\n                              ))}\n                            </div>\n                          ) : null}\n                          <div\n                            style={{\n                              display: '-webkit-box',\n                              webkitBoxOrient: 'vertical',\n                              WebkitLineClamp: 7,\n                              overflow: 'hidden',\n                            }}\n                          >\n                            <div\n                              style={{\n                                textDecoration: 'underline',\n                                position: 'relative',\n                              }}\n                            >\n                              {topic_info.Title}\n                            </div>\n                            <div style={{ textIndent: grem }}>\n                              {topic_info.Year} &middot; {topic_info.Runtime}{' '}\n                              &middot; {topic_info.Rated}\n                            </div>\n                            <div style={{ textIndent: grem }}>\n                              {topic_info.Plot}\n                            </div>\n                          </div>\n                          <div\n                            style={{\n                              textDecoration: 'underline',\n                              textIndent: grem,\n                              display: 'none',\n                            }}\n                          >\n                            show reviews\n                          </div>\n                          <div\n                            style={{\n                              position: 'absolute',\n                              bottom: 0,\n                              left: 0,\n                            }}\n                          >\n                            {reviews.length} reviews &middot; {counts[1]}{' '}\n                            positive (\n                            {Math.floor((counts[1] / combined.length) * 100) /\n                              1}\n                            %)\n                          </div>\n                          <div\n                            className=\"hover-block\"\n                            style={{\n                              position: 'absolute',\n                              left: -grem / 2 - 0.5,\n                              top: -grem / 2 - 0.5,\n                              right: -grem / 2 - 0.5,\n                              bottom: -grem / 2 - 0.5,\n                              background: 'rgba(0,0,0,0.0625)',\n                            }}\n                          />\n                        </a>\n                      </Link>\n                    )\n                  })}\n                </>\n              ) : null}\n            </div>\n          </div>\n        </div>\n        <Bar\n          grem={grem}\n          setAnalyze={setAnalyze}\n          analyze={analyze}\n          combined={combined}\n          total={true}\n        />\n      </div>\n    )\n  }\n}\n\nexport default Index\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;;;;;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAAA;AAIA;AAEA;AACA;AAEA;AAEA;AAAA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AAJA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;AACA;AACA;AAJA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AAGA;AACA;AACA;AACA;AAHA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAZA;AA4BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAPA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAmBA;AACA;AACA;AACA;AACA;AAJA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AAFA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AAHA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AACA;AAHA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAOA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;;;;AA/ZA;AACA;AAiaA;;;;A","sourceRoot":""}